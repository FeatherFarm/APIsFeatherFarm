<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/styleCadastro.css">
    <link rel="icon" type="image/x-icon" href="./assets/assetsIndex/logo.png">

    <title>Cadastro</title>
</head>

<body>
    <div class="container">
        <form action="login.html" class="form">
            <h1 class="text-center">Cadastro</h1>
            <!-- barra de progresso -->
            <div class="progressbar">
                <div class="progress" id="progress"></div>
                <div class="progress-step progress-step-active">

                </div>
                <div class="progress-step"></div>
                <div class="progress-step"></div>
                <div class="progress-step"></div>
            </div>

            <!-- final da barra de progresso-->
            <div class="form-step form-step-active">
                <div class="input-group">
                    <label for="nome_razão_social">RAZÃO SOCIAL <b style="color: red;"
                            title="Este campo é obrigatório">*</b></label>
                    <input id="input_razão_social" autocomplete="off" type="text" name="razão_social"
                        placeholder="Exemple: Feather Farm" required="required" minlength="2" maxlength="50">
                </div>

                <div class="input-group">
                    <label for="nome_fantasia">Nome fantasia <b style="color: red;"
                            title="Este campo é obrigatório">*</b></label>
                    <input id="input_nome_fantasia" autocomplete="off" type="text" name="nome_fantasia"
                        placeholder="Exemple: Feather Farm" required="required" minlength="2" maxlength="50">
                </div>

                <div class="input-group">
                    <label for="cnpj_empresa">CNPJ <b style="color: red;" title="Este campo é obrigatório">*</b></label>
                    <input id="input_cnpj" autocomplete="off" type="text" name="cnpj" placeholder="00.000.000/0001-00"
                        required="required" maxlength="18" minlength="18">
                </div>

                <div class="input-group">
                    <label for="Senha">SENHA <b style="color: red;" title="Este campo é obrigatório">*</b></label>
                    <input id="input_senha" autocomplete="off" type="password" name="senha" placeholder="********"
                        required="required" maxlength="8">
                </div>

                <div class="">
                    <a href="#" class="btn btn-next width-50 ml-auto">Proximo</a>
                </div>
            </div>


            <div class="form-step">
                <div class="input-group">
                    <label for="cep">CEP <b style="color: red;" title="Este campo é obrigatório">*</b></label>
                    <input id="input_cep" autocomplete="off" type="text" name="cep" placeholder="01234-567"
                        required="required" minlength="9" maxlength="9">
                </div>

                <div class="input-group">
                    <label for="logradouro_endereco">LOGRADOURO <b style="color: red;"
                            title="Este campo é obrigatório">*</b></label>
                    <input id="input_logradouro" autocomplete="off" type="text" name="logradouro"
                        placeholder="Logradouro" required="required" minlength="5" maxlength="50">
                </div>

                <div class="input-group">
                    <label for="numero_endereco">Nº <b style="color: red;"
                            title="Este campo é obrigatório">*</b></label>
                    <input id="input_numero" autocomplete="off" type="text" name="numero" placeholder="Exemple: 12345"
                        required="required" minlength="1" maxlength="5">
                </div>

                <div class="input-group">
                    <label for="Bairro_endereco">BAIRRO <b style="color: red;"
                            title="Este campo é obrigatório">*</b></label>
                    <input id="input_bairro" autocomplete="off" type="text" name="bairro" placeholder="Bairro"
                        required="required" min="2" maxlength="50">
                </div>

                <div class="btns-group">
                    <a href="#" class="btn btn-prev">Voltar</a>
                    <a href="#" class="btn btn-next">Proximo</a>
                </div>
            </div>

            <div class="form-step">
                <div class="input-group">
                    <label for="Uf">UF <b style="color: red;" title="Este campo é obrigatório">*</b></label>
                    <!-- <input id="input_uf" autocomplete="off" class="input_uppercase" minlength="2" maxlength="2" type="text" name="uf" placeholder="SP"
                        required="required"> -->
                    <select class="select_uf" name="UF" id="select_uf">
                        <option value=""></option>
                        <option value="AC">AC</option>
                        <option value="AL">AL</option>
                        <option value="AP">AP</option>
                        <option value="AM">AM</option>
                        <option value="BR">BA</option>
                        <option value="CE">CE</option>
                        <option value="DF">DF</option>
                        <option value="ES">ES</option>
                        <option value="GO">GO</option>
                        <option value="MA">MA</option>
                        <option value="MT">MT</option>
                        <option value="MS">MS</option>
                        <option value="MG">MG</option>
                        <option value="PA">PA</option>
                        <option value="PB">PB</option>
                        <option value="PR">PR</option>
                        <option value="PE">PE</option>
                        <option value="PI">PI</option>
                        <option value="RJ">RJ</option>
                        <option value="RN">RN</option>
                        <option value="RS">RS</option>
                        <option value="RO">RO</option>
                        <option value="RR">RR</option>
                        <option value="SC">SC</option>
                        <option value="SP">SP</option>
                        <option value="SE">SE</option>
                        <option value="TO">TO</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="Cidade">CIDADE <b style="color: red;" title="Este campo é obrigatório">*</b></label>
                    <input id="input_cidade" autocomplete="off" type="text" name="cidade"
                        placeholder="Exemple: São Paulo" required="required" min="2" maxlength="50">
                </div>

                <div class="input-group">
                    <label for="Nome_responsavel">NOME <b style="color: red;"
                            title="Este campo é obrigatório">*</b></label>
                    <input id="input_nome" autocomplete="off" type="text" name="nome"
                        placeholder="Responsável pelo cadastro" required="required" min="2" maxlength="50">
                </div>

                <div class="input-group">
                    <label for="Sobrenome_responsavel">SOBRENOME <b style="color: red;"
                            title="Este campo é obrigatório">*</b></label>
                    <input id="input_sobrenome" autocomplete="off" type="text" name="sobrenome"
                        placeholder="Responsável pelo cadastro" required="required" min="2" maxlength="50">
                </div>

                <div class="btns-group">
                    <a href="#" class="btn btn-prev">Voltar</a>
                    <a href="#" class="btn btn-next">Proximo</a>
                </div>
            </div>

            <div class="form-step">
                <div class="input-group">
                    <label for="Email">EMAIL <b style="color: red;" title="Este campo é obrigatório">*</b></label>
                    <input id="input_email" autocomplete="off" type="email" name="email"
                        placeholder="Exemple@exemple.com" required="required" minlength="3" maxlength="50">
                </div>

                <div class="input-group">
                    <label for="Email2">EMAIL (2)</label>
                    <input id="input_email2" autocomplete="off" type="email" name="email2"
                        placeholder="Exemple@exemple.com" minlength="3" maxlength="50">
                </div>

                <div class="input-group">
                    <label for="Telefone">TELEFONE <b style="color: red;" title="Este campo é obrigatório">*</b></label>
                    <input id="input_telefone" autocomplete="off" type="tel" name="tel" placeholder="(01)2345-6789"
                        required="required" minlength="13" maxlength="13">
                </div>

                <div class="input-group">
                    <label for="Telefone2">TELEFONE (2)</label>
                    <input id="input_telefone2" autocomplete="off" type="tel" name="tel2" placeholder="(01)2345-6789"
                        minlength="13" maxlength="13">
                </div>

                <div class="btns-group">
                    <a href="#" class="btn btn-prev">Voltar</a>
                    <button style="border:none" class="btn" onclick="Validacao()">Concluir</button>
                </div>
            </div>
        </form>

        <div class="form-image">
            <div class="image-logo"><a href="./index.html" id="img_logo">
                    <img src="./assets/assetsCadastro/logoComNome.png" alt="img logo">
                </a></div>
            <div class="image-farm">
                <img src="./assets/assetsCadastro/ImagemCadastro.png" alt="img cadastro">
            </div>

        </div>
    </div>
</body>

</html>
<script>
    // ---------- barra de progresso ----------
    const prevBtns = document.querySelectorAll(".btn-prev");
    const nextBtns = document.querySelectorAll(".btn-next");
    const progress = document.getElementById("progress");
    const formSteps = document.querySelectorAll(".form-step");
    const progressSteps = document.querySelectorAll(".progress-step");

    let formStepsNum = 0;

    nextBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
            formStepsNum++;
            updateFormSteps();
            updateProgressbar();
        });
    });

    prevBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
            formStepsNum--;
            updateFormSteps();
            updateProgressbar();
        });
    });

    function updateFormSteps() {
        formSteps.forEach((formStep) => {
            formStep.classList.contains("form-step-active") &&
                formStep.classList.remove("form-step-active");
        });

        formSteps[formStepsNum].classList.add("form-step-active");
    }

    function updateProgressbar() {
        progressSteps.forEach((progressStep, idx) => {
            if (idx < formStepsNum + 1) {
                progressStep.classList.add("progress-step-active");
            } else {
                progressStep.classList.remove("progress-step-active");
            }
        });

        const progressActive = document.querySelectorAll(".progress-step-active");

        progress.style.width =
            ((progressActive.length - 1) / (progressSteps.length - 1)) * 100 + "%";
    }

    // ---------- Mascara para as inputs ----------

    const cep = document.querySelector("input_cep")

    input_cep.addEventListener("keypress", () => {
        let ceplength = input_cep.value.length

        if (ceplength === 5) {
            input_cep.value += '-'
        }
    })

    const cnpj = document.querySelector("input_cnpj")

    input_cnpj.addEventListener("keypress", () => {
        let cnpjlength = input_cnpj.value.length

        if (cnpjlength === 2 || cnpjlength === 6) {
            input_cnpj.value += '.'
        } else if (cnpjlength === 10) {
            input_cnpj.value += '/'
        } else if (cnpjlength === 15) {
            input_cnpj.value += '-'
        }
    })

    const telefone = document.querySelector("input_telefone")

    input_telefone.addEventListener("keypress", () => {
        let tellength = input_telefone.value.length

        if (tellength === 0) {
            input_telefone.value += '('
        } else if (tellength === 3) {
            input_telefone.value += ')'
        } else if (tellength === 8) {
            input_telefone.value += '-'
        }
    })

    const telefone2 = document.querySelector("input_telefone")

    input_telefone2.addEventListener("keypress", () => {
        let tel2length = input_telefone2.value.length

        if (tel2length === 0) {
            input_telefone2.value += '('
        } else if (tel2length === 3) {
            input_telefone2.value += ')'
        } else if (tel2length === 8) {
            input_telefone2.value += '-'
        }
    })



    function Validacao() {
        var RazãoSocial = input_razão_social.value;
        var Cnpj = input_cnpj.value;
        var Nome_fantasia = input_nome_fantasia.value;
        var Senha = input_senha.value;
        var Logradouro = input_logradouro.value;
        var Numero = input_numero.value;
        var Bairro = input_bairro.value;
        var Uf = select_uf.value;
        var Cep = input_cep.value;
        var Cidade = input_cidade.value;
        var Nome = input_nome.value;
        var Sobrenome = input_sobrenome.value;
        var EmailCadastro = input_email.value;
        var Email2Cadastro = input_email2.value;
        var Telefone = input_telefone.value;
        var Telefone2 = input_telefone2.value;


        if (RazãoSocial == false || RazãoSocial.length < 2) {
            alert("Parece que você preencheu algum campo incorretamente!")
        } else if (Cnpj == false || Cnpj.length < 18) {
            alert("Parece que você preencheu algum campo incorretamente!")
        } else if (Nome_fantasia == false || Nome_fantasia.length < 2) {
            alert("Parece que você preencheu algum campo incorretamente!")
        } else if ((Senha == false || Senha == true) && Senha.length < 3) {
            alert("Parece que você preencheu algum campo incorretamente!")
        } else if (Logradouro == false || Logradouro.length < 5) {
            alert("Parece que você preencheu algum campo incorretamente!")
        } else if (Numero == false || Numero.length < 1) {
            alert("Parece que você preencheu algum campo incorretamente!")
        } else if (Bairro == false || Bairro.length < 2) {
            alert("Parece que você preencheu algum campo incorretamente!")
        } else if (Uf == false || Uf.length < 2) {
            alert("Parece que você preencheu algum campo incorretamente!")
        } else if (Cep == false || Cep.length < 9) {
            alert("Parece que você preencheu algum campo incorretamente!")
        } else if (Cidade == false || Cidade.length < 2) {
            alert("Parece que você preencheu algum campo incorretamente!")
        } else if (Nome == false || Nome.length < 2) {
            alert("Parece que você preencheu algum campo incorretamente!")
        } else if (Sobrenome == false || Sobrenome.length < 2) {
            alert("Parece que você preencheu algum campo incorretamente!")
        } else if (EmailCadastro == false || EmailCadastro.length < 5) {
            alert("Parece que você preencheu algum campo incorretamente!")
        } else if (Telefone == false || Telefone.length < 13) {
            alert("Parece que você preencheu algum campo incorretamente!")
        } else if (Telefone2 == true && Telefone2.length < 13) {
            alert("Parece que você preencheu algum campo incorretamente!")
        } else if (Email2Cadastro == true && Email2Cadastro.length < 5) {
            alert("Parece que você preencheu algum campo incorretamente!")
        } else {
            cadastrar()
        }

        function cadastrar() {
            var RazãoSocialVar = input_razão_social.value;
            var CnpjVar = input_cnpj.value;
            var Nome_fantasiaVar = input_nome_fantasia.value;
            var SenhaVar = input_senha.value;
            var LogradouroVar = input_logradouro.value;
            var NumeroVar = input_numero.value;
            var BairroVar = input_bairro.value;
            var UfVar = select_uf.value;
            var CepVar = input_cep.value;
            var CidadeVar = input_cidade.value;
            var NomeVar = input_nome.value;
            var SobrenomeVar = input_sobrenome.value;
            var EmailCadastroVar = input_email.value;
            var Email2CadastroVar = input_email2.value;
            var TelefoneVar = input_telefone.value;
            var Telefone2Var = input_telefone2.value;

            fetch("/usuarios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    RazãoSocialServer: RazãoSocialVar,
                    CnpjServer: CnpjVar,
                    Nome_fantasiaServer: Nome_fantasiaVar,
                    SenhaServer: SenhaVar,
                    LogradouroServer: LogradouroVar,
                    NumeroServer: NumeroVar,
                    BairroServer: BairroVar,
                    UfServer: UfVar,
                    CepServer: CepVar,
                    CidadeServer: CidadeVar,
                    NomeServer: NomeVar,
                    SobrenomeServer: SobrenomeVar,
                    EmailCadastroServer: EmailCadastroVar,
                    Email2CadastroServer: Email2CadastroVar,
                    TelefoneServer: TelefoneVar,
                    Telefone2Server: Telefone2Var,
                })
            }).then(function (resposta) {

                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    alert("Cadastro Realizado com sucesso, indo para tela de login")

                    setTimeout(() => {
                        window.location = "login.html";
                    }, "2000")

                } else {
                    throw ("Houve um erro ao tentar realizar o cadastro!");
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

            return false;
        }

    }

</script>